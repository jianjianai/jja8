<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=zh-CN lang=zh-cn><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.104.3"><meta name=viewport content="width=device-width,initial-scale=1"><title>1000人服务器事情经过和总结:庄主举办的1000人同屏竞技活动的经过的总结和分析。</title><meta name=description content><meta name=baidu-site-verification content="code-zuAAizjiM8"><meta name=msvalidate.01 content="07632F39AB3B1DE13D72819912B5F3C5"><meta name=description content="简的秘密基地，发布一些有意思的作品。"><link type=text/css rel=stylesheet href=https://www.jja8.cn/css/整体效果.css><link type=text/css rel=stylesheet href=https://www.jja8.cn/css/文章.css><link rel="shortcut icon" href=https://www.jja8.cn//插件实验室.png></head><body><div id=导航栏><div id=网站标识><img class=网站图标 src=https://www.jja8.cn//插件实验室.png><div id=站点文本><h1 id=站点文本标题><span><a href=/ title=w.jja8.cn:88 rel=home>简的秘密基地</a></span></h1><span id=网站表示简介>jja8.cn</span></div></div><div><ul style=margin-right:14px><li class=导航栏列表><a href=/ target=_self>主页</a>
<a href=/tags target=_self>分类</a></li></ul></div></div><div id=主页面><div id=文章布局框><div id=标题卡片 style=background-image:url(https://www.jja8.cn/img/1000%e4%ba%ba%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%ba%8b%e6%83%85%e7%bb%8f%e8%bf%87%e5%92%8c%e6%80%bb%e7%bb%93/%e5%b0%81%e9%9d%a2.jpg)><div id=文章元素背景><div id=文章元素框><h2 id=文章标题>1000人服务器事情经过和总结</h2><p id=文章简介>庄主举办的1000人同屏竞技活动的经过的总结和分析。</p><p id=文章时间日期>2022-10-04 16:52</p><p id=文章提要>我们过于相信服务商，把服务器完全交给服务商部署造成了此次的遗憾。</p></div></div></div><div id=文章内容框><div id=文章内容正文><h1 id=1000人服务器事情经过和总结>1000人服务器事情经过和总结</h1><p>这次1000人同屏竞技活动我们准备的是非常充分的，在9月14日就开始讨论这次活动的内容，并且已经初步确认大致流程，也把任务都分配完成了。</p><p>我们开发团队一共三人，大米，夜光和我。
大米和我负责语音插件魔改，但是没有成功。夜光负责反作弊。
我还要负责MultiPaper服务端的部署和插件开发，所以这次活动的服务器架构和技术方案我是最清楚的。</p><h2 id=事情经过>事情经过</h2><h3 id=9月14日>9月14日</h3><p>我们初步确定了服务器架构使用MultiPaper，并且通过查阅资料确定了这种架构的服务端是完全可以容纳1000人同屏竞技的，并且此服务端已经在国外有过两次大型活动并且非常成功，一次是550人，一次是1000人。</p><p>因为我们的开发环境是windows系统，为了方便迁移我们要求服务商也使用windows系统搭建服务器。</p><h3 id=9月28日>9月28日</h3><p>我们完成了服务端的开发与调试，当时我们的计划是在10月1日举办活动。要求服务商提供服务器进行测试，服务商拒绝了我们的请求，要求我们将服务器打包发送给他们，他们帮我们部署。于是我将服务器打包发送给服务商。</p><h3 id=9月29日-下午823>9月29日 下午8:23</h3><p>服务商说他们机房机器刚到货正在安装，无法部署服务端。
当天承诺给我们两台5900X CPU的机器用于举办活动。</p><h3 id=9月30日-下午501>9月30日 下午5:01</h3><p>我们询问服务商情况得知他们依然没有完成服务端部署，理由是正在装系统。</p><h3 id=10月1日-深夜0023>10月1日 深夜00:23</h3><p>庄主给我打了个电话，我没接到。迷迷糊糊醒来得知服务商在部署服务器时遇到了问题。
当我尝试联系服务商解决问题时，联系不上。</p><h3 id=10月1日-上午726>10月1日 上午7:26</h3><p>负责与我们沟通的负责人说自己在机房睡着了。</p><h3 id=10月1日-上午925>10月1日 上午9:25</h3><p>我指导他们解决了问题。</p><h3 id=10月1日-上午1021>10月1日 上午10:21</h3><p>服务商提出使用Velocity+multipaper方案，我赞同此方案。
并且指导他们配置Velocity服务端。</p><h3 id=10月1日-上午1139>10月1日 上午11:39</h3><p>因为服务器还没部署完成，活动已经确定要推迟了。
我继续指导服务商完成数据库连接等配置。</p><h3 id=10月2日-晚上903>10月2日 晚上9:03</h3><p>完成了全部服务器配置。
确定了活动时间10月3日下午举行。</p><h3 id=10月3日-中文1201>10月3日 中文12:01</h3><p>夜光指导服务商安装反作弊插件并完成配置。此时活动的消息已经放出。</p><h3 id=10月3日-下午209>10月3日 下午2:09</h3><p>夜光开始对反作弊插件进行测试，并优化配置。</p><h3 id=10月3日-下午610>10月3日 下午6:10</h3><p>反作弊插件微调完成，几乎所有外挂都无法逃避检测，并且不会出现误判了。</p><h3 id=10月3日-下午710>10月3日 下午7:10</h3><p>服务器在线人数达到200人，此时服务器开始出现了卡顿，我尝试找到原因。一直查询各子服务器tps。
所有服务器都是20。最初是怀疑网络带宽不够导致。于是联系服务商询问宽带使用情况，得知最大带宽是1Gbps，当时上行带宽使用量不知，因为<strong>我们团队没有服务器后台</strong>。只能先向服务商申请提高上行带宽。并且要求服务商排查问题。</p><h3 id=10月3日-下午750>10月3日 下午7:50</h3><p>服务器在线人数达到600人，并且伴随DDOS和假人攻击。
我们要求服务商给我们服务器后台，方便排查情况和解决攻击问题。并且要求服务商对TCP请求过多的ip进行封禁。</p><h3 id=10月3日-下午82>10月3日 下午8:2</h3><p>我认为，假人攻击已经被解决。进入服务器的玩家只有很少是假人了，因为已经对单个ip的TCP请求做了限制。多出的请求直接丢弃，此时应该是大量玩家涌入。
此时我们仍然没有服务器后台，ip的tcp连接限制是服务商帮我们设置的。</p><p>夜光和大米提出增加登录服的方式解决假人攻击。
为了保险起见我也很赞同此方案。
并且此时我去临时写一个禁止一个ip频繁加入退出服务器的插件。</p><h3 id=10月3日-下午87>10月3日 下午8:7</h3><p>服务商将后台交给我们团队。
此时为了不影响登录服务器的部署，我没有上后台查看情况。
夜光开始部署登录服务器。</p><h3 id=10月3日-下午821>10月3日 下午8:21</h3><p>我进入后台开始设置multipaper，和登录服务器对接。
此时发现，multipaper主服务器并不在这台机器上，并且和他们沟通得知multipaper主服务器在另外一台E5处理器的机器上，并且我没拿到那台机器的后台。得知将multipaper主服务器部署在E5处理器的机器上后结合服务器卡顿的症状，我怀疑是multipaper主服务器不堪重负导致的卡顿。
我尝试将multipaper主服务器部署到这台性能强劲的5900X的机器上，并且要求服务商迁移端口映射到这台机器。</p><h3 id=10月3日-下午915>10月3日 下午9:15</h3><p>我完成任务后，大米提出了登录服务器的解决方案，我将后台交给大米。因为和大米没有语音交流，大米不知道我重新部署了服务端，于是将先前的服务端启动，multipaper主服务器依然在E5的机器上。</p><h3 id=10月3日-下午930>10月3日 下午9:30</h3><p>部署完成后玩家蜂拥而至，当服务器玩家数量达到300人时先前的卡顿再次出现。</p><h3 id=10月3日-下午950>10月3日 下午9:50</h3><p>庄主已经放弃此次活动并且开始处理后事了。</p><h2 id=总结>总结</h2><p>我们应该拒绝由服务商部署服务器，应该要求服务商将后台交给我们自己部署。</p><p>卡顿的原因，是Mulitipaper主服务器在一台并不属于本次活动的机器上，主频较低导致所有服务器交换数据延迟造成的卡顿。</p></div></div></div></div><div id=友情链接><p>友情链接:
<a href=https://git.cnluminous.com/>夜光的小窝</a>，
<a href=http://www.extcraft.com/>SmallL-U的技术博客</a></p></div><div id=页脚><div class=页脚内容><p>本设计由简.精心制作</p><a href=/>Copyright © 2016-2020 简的秘密基地. All rights reserved.</a></div></div></body></html>