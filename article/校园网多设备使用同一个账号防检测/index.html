<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=zh-CN lang=zh-cn><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.104.3"><meta name=viewport content="width=device-width,initial-scale=1"><title>校园网多设备防检测:一人办宽带，全班免费蹭。</title><meta name=description content><meta name=baidu-site-verification content="code-zuAAizjiM8"><meta name=msvalidate.01 content="07632F39AB3B1DE13D72819912B5F3C5"><meta name=description content="简的秘密基地，发布一些有意思的作品。"><link type=text/css rel=stylesheet href=https://www.jja8.cn/css/整体效果.css><link type=text/css rel=stylesheet href=https://www.jja8.cn/css/文章.css><link rel="shortcut icon" href=https://www.jja8.cn//插件实验室.png></head><body><div id=导航栏><div id=网站标识><img class=网站图标 src=https://www.jja8.cn//插件实验室.png><div id=站点文本><h1 id=站点文本标题><span><a href=/ title=w.jja8.cn:88 rel=home>简的秘密基地</a></span></h1><span id=网站表示简介>jja8.cn</span></div></div><div><ul style=margin-right:14px><li class=导航栏列表><a href=/ target=_self>主页</a>
<a href=/tags target=_self>分类</a></li></ul></div></div><div id=主页面><div id=文章布局框><div id=标题卡片 style=background-image:url(https://www.jja8.cn/img/%e6%a0%a1%e5%9b%ad%e7%bd%91%e5%a4%9a%e8%ae%be%e5%a4%87%e4%bd%bf%e7%94%a8%e5%90%8c%e4%b8%80%e4%b8%aa%e8%b4%a6%e5%8f%b7%e9%98%b2%e6%a3%80%e6%b5%8b/%e8%ae%a4%e8%af%81%e4%b8%8a%e7%bd%91.png)><div id=文章元素背景><div id=文章元素框><h2 id=文章标题>校园网多设备防检测</h2><p id=文章简介>一人办宽带，全班免费蹭。</p><p id=文章时间日期>2022-09-21 10:43</p><p id=文章提要>使用openwtr绕过校园网设备检测，多设备共享同一宽带。</p></div></div></div><div id=文章内容框><div id=文章内容正文><h1 id=校园网多设备使用同一个账号防检测>校园网多设备使用同一个账号防检测</h1><h2 id=前言>前言</h2><p><strong>我们的校园网巨贵，而且巨坑。</strong></p><p><strong>自己的路由器却是在为校园网服务</strong></p><p>绕过校园网检测首先需要有一个可以刷openwrt的路由器。</p><p>openwrt是一个开源的基于Linux的路由器系统，在他上面可以实现各种各样的功能，总之是非常的强大。</p><p>这次整活也就在这个系统上整。</p><h2 id=收费巨贵还限制设备的校园网>收费巨贵还限制设备的校园网。</h2><p>我们学校的校园网是每个寝室都有一条光纤，但是这个光纤和家用的有很大区别。</p><p><img src=/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%A4%9A%E8%AE%BE%E5%A4%87%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E8%B4%A6%E5%8F%B7%E9%98%B2%E6%A3%80%E6%B5%8B/%E5%85%89%E7%8C%AB%E8%B7%AF%E7%94%B1%E5%99%A8.jpg alt=光猫路由器></p><p>他们连接网络的方式是：我们花200租一个光猫，然后这个光猫只是接入一下他们的局域网。</p><p>之后还要自己购买一个路由器，而路由器的工作模式必须是桥接模式。手机和电脑接入连接自己路由器的wifi只是加入了他们的局域网。</p><p><img src=/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%A4%9A%E8%AE%BE%E5%A4%87%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E8%B4%A6%E5%8F%B7%E9%98%B2%E6%A3%80%E6%B5%8B/wifi.jpg alt=wifi></p><p>并且手机连接自己的路由器是不能上网的，需要登录才能上网。</p><p><img src=/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%A4%9A%E8%AE%BE%E5%A4%87%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E8%B4%A6%E5%8F%B7%E9%98%B2%E6%A3%80%E6%B5%8B/%E8%AE%A4%E8%AF%81%E4%B8%8A%E7%BD%91.png alt=认证界面></p><p>也就是手机电脑想使用WiFi就必须购买一个路由器然后把自己的路由器加入他们的网络作为AP节点，然后自己的电脑和手机登录他们的校园网账号。</p><p>那么我们自己也就不能创建属于自己的局域网。</p><p>不能创建自己的局域网意味着什么？windows文件共享不存在了。一些需要依靠局域网联机的游戏也不能联机了。等等。</p><p><strong>我觉得这样的网络非常不合理。</strong></p><p>如果你想直接用你自己的路由器DHCP上网，当你连接几台设备后你的账号就会被封禁10分钟。</p><p>这个方法我已经尝试过了，具体方法是：</p><p>将路由器设置成DHCP模式获取到一个他们的10开头的大内网，然后再用其他设置连接自己路由器获取到192开头的自己的内网ip。
之后因为连接会被路由器转发，所以可以用手机登录校园网。这个过程相当于手机帮路由器认证了。之后所有连接到路由器的设备都可以上网。
但是别高兴得太早，这样使用不到3分钟就无法上网了，当你再次登录的时候就会提示你的账号被封禁10分钟。</p><p><img src=/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%A4%9A%E8%AE%BE%E5%A4%87%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E8%B4%A6%E5%8F%B7%E9%98%B2%E6%A3%80%E6%B5%8B/%E7%A6%81%E6%AD%A2%E4%BD%BF%E7%94%A8.png alt=无法登录界面></p><p><strong>所以我觉得这样的网络非常不合理。</strong></p><h2 id=使用openwrt软路由绕过检测>使用openwrt软路由绕过检测</h2><h3 id=关于校园网的检测多设备的方式>关于校园网的检测多设备的方式</h3><p>检测一个账号是否给多个设备使用的方法其实就几种。</p><p><strong>基于 HTTP 数据包请求头内的 User-Agent 字段的检测</strong></p><p>这种方法对于现在的网络状况其实已经有点无能为力了，因为现在几乎所有网站都使用https的协议。
因为https是加密的，所以也就无法检测了。</p><p>但是还是有少数应用和网站仍然使用http这一古老的协议，所以还是需要防范以下。并且经过测试，我们学校貌似也依然还在使用这种检测方式。</p><p>HTTP数据包请求头存在一个叫做 User-Agent 的字段，该字段通常能够标识出操作系统类型，例如：</p><pre tabindex=0><code>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.72 Safari/537.36 Edg/89.0.774.45

Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405
</code></pre><p>若发现同时出现例如Windows NT 10.0 iPad 的字段，则判定存在多设备上网。</p><p><strong>基于 IPv4 数据包包头内的 TTL 字段的检测</strong></p><p>这种检测方式使用比较广泛，他的原理是检测数据包的TTL，数据包每经过一次转发TTL就会减1。
windows默认的TTL是128，手机一般是64。当电脑访问一个网站时，如果数据包没经过转发，在经过
校园网网关的时候TTL就是128，没有改变。如果连接了一个路由器，在经过校园网网关的时后TTL就会变成127
手机也是同样的道理，对于这种检测方式我们可以用修改TTL的方法绕过检测。</p><p><strong>基于 IPv4 数据包包头内的 Identification 字段的检测</strong></p><p>这种检测方式使用比较少，但是我们学校貌似使用了这个方式。总之都防范一下，稳妥。</p><p>IPID的检测方式可以参考这篇文章：http://www.techwander.cn/Wordpress/ipid%e9%9a%90%e8%97%8f%e7%bd%91%e7%bb%9c%e6%89%ab%e6%8f%8f/</p><p>我简单描述一下原理，就是检测IPID序号的增加和减少。</p><p>这里有一个项目可以绕过IPID的检测：https://github.com/CHN-beta/rkp-ipid</p><p><strong>基于网络协议栈时钟偏移的检测</strong></p><p>这种检测方式使用比较广泛，他的原理是不同主机物理时钟偏移不同，通过分析分析不同主机发送报文的频率来检测是否存在多态设备。</p><p><strong>DPI (Deep Packet Inspection) 深度包检测技术</strong></p><p>这个检测方案比较先进，检测系统会抓包分析应用层的流量，根据不同应用程序的数据包的特征值来判断出是否存在多设备上网。</p><p>此种方式已确认在锐捷相关设备上应用，当由于此项功能极耗费性能，因此有些学校可能不会开启此项功能。</p><p>对于这个技术基本上无解，唯一的办法就是使用代理上网加密数据包。</p><p>但是这种检测方案非常耗性能，所以一般学校不会开启此功能。</p><h3 id=应对方法>应对方法</h3><p><strong>基于 HTTP 数据包请求头内的 User-Agent 字段的检测</strong>
通过 Privoxy 修改 User-Agent</p><p>首先安装软件包</p><pre tabindex=0><code>opkg update
opkg install privoxy luci-app-privoxy luci-i18n-privoxy-zh-cn
</code></pre><p>进入 Privoxy 管理页面设置，进入文件与目录，Action Files 中只保留 match-all.action，Filter Files 与 Trust Files 留空；进入访问控制，Listen Address 填写 0.0.0.0:8118，Permit Address 填写 192.168.0.0/16，勾选 Enable Action File Editor；进入杂项，勾选 Accept Intercepted Requests；进入日志，取消全部选项；点击保存并应用；进入 OpenWRT 防火墙设置，在自定义设置中填入以下内容：</p><pre tabindex=0><code># 将局域网内的 HTTP 请求转发到 Privoxy 代理服务器上
iptables -t nat -N http_ua_drop
iptables -t nat -I PREROUTING -p tcp --dport 80 -j http_ua_drop
iptables -t nat -I PREROUTING -p tcp --dport 8080 -j http_ua_drop
iptables -t nat -A http_ua_drop -m mark --mark 1/1 -j RETURN
iptables -t nat -A http_ua_drop -d 0.0.0.0/8 -j RETURN
iptables -t nat -A http_ua_drop -d 127.0.0.0/8 -j RETURN
iptables -t nat -A http_ua_drop -d 192.168.0.0/16 -j RETURN
iptables -t nat -A http_ua_drop -p tcp -j REDIRECT --to-port 8118
</code></pre><p>打开 <a href="http://config.privoxy.org/edit-actions-list?f=0">http://config.privoxy.org/edit-actions-list?f=0</a>；点击Edit，在 Action 那一列中，hide-user-agent 改选为 Enable - 在右侧 User Agent string to send 框中填写Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.108 Safari/537.36，其它全部选择为 No Change；点击 Submit。</p><p><strong>基于 IPv4 数据包包头内的 TTL 字段的检测</strong></p><p>修改所以经过路由器的数据包TTL值为固定值即可防止检测。</p><p>首先安装需要的软件包。</p><pre tabindex=0><code>opkg update
opkg install iptables-mod-ipopt kmod-ipt-ipopt
</code></pre><p>配置防火墙，添加规则。即可将所有经过路由器的TTL值修改为64
进入 OpenWRT 防火墙设置，在 自定义设置 中填入以下内容：</p><pre tabindex=0><code>iptables -t mangle -A POSTROUTING -j TTL --ttl-set 64
</code></pre><p><strong>基于 IPv4 数据包包头内的 Identification 字段的检测</strong></p><p>我们使用 rkp-ipid 这一内核模块进行修改。项目地址：https://github.com/CHN-beta/rkp-ipid</p><p>下载并安装rkp-ipid</p><pre tabindex=0><code>git clone https://github.com/CHN-beta/rkp-ipid.git package/rkp-ipid
make package/rkp-ipid/compile V=sc
</code></pre><p>设置所有发出的数据包的 IPID 为递增
进入 OpenWRT 防火墙设置，在 自定义设置 中填入以下内容：
注释的一行根据自己的校园网情况，因为我所在的是10开头的内网所以注释掉了10那个。</p><pre tabindex=0><code>iptables -t mangle -N IPID_MOD
iptables -t mangle -A FORWARD -j IPID_MOD
iptables -t mangle -A OUTPUT -j IPID_MOD
iptables -t mangle -A IPID_MOD -d 0.0.0.0/8 -j RETURN
iptables -t mangle -A IPID_MOD -d 127.0.0.0/8 -j RETURN
# iptables -t mangle -A IPID_MOD -d 10.0.0.0/8 -j RETURN
iptables -t mangle -A IPID_MOD -d 172.16.0.0/12 -j RETURN
iptables -t mangle -A IPID_MOD -d 192.168.0.0/16 -j RETURN
iptables -t mangle -A IPID_MOD -d 255.0.0.0/8 -j RETURN
iptables -t mangle -A IPID_MOD -j MARK --set-xmark 0x10/0x10
</code></pre><p><strong>基于网络协议栈时钟偏移的检测</strong></p><p>在局域网中建立 NTP 服务器统一时间戳即可。</p><p>进入 OpenWRT 系统设置, 勾选 Enable NTP client（启用 NTP 客户端）和 Provide NTP server（作为 NTP 服务器提供服务）</p><p>NTP server candidates（候选 NTP 服务器）四个框框分别填写:</p><pre tabindex=0><code>ntp1.aliyun.com
time1.cloud.tencent.com
stdtime.gov.hk
pool.ntp.org
</code></pre><p>进入 OpenWrt 防火墙设置，在 自定义设置 中填入以下内容:
最后的 192.168.1.1 需要修改为路由器网关地址</p><pre tabindex=0><code>iptables -t nat -N ntp_force_local
iptables -t nat -I PREROUTING -p udp --dport 123 -j ntp_force_local
iptables -t nat -A ntp_force_local -d 0.0.0.0/8 -j RETURN
iptables -t nat -A ntp_force_local -d 127.0.0.0/8 -j RETURN
iptables -t nat -A ntp_force_local -d 192.168.0.0/16 -j RETURN
iptables -t nat -A ntp_force_local -s 192.168.0.0/16 -j DNAT --to-destination 192.168.1.1
</code></pre><p>这样 NTP 请求就会被劫持到路由器上了。</p><p><strong>基于 IPv4 数据包包头内的 Identification 字段的检测</strong>
和
<strong>基于 IPv4 数据包包头内的 TTL 字段的检测</strong>
一起解决</p><p>直接不使用传统nat方式转发内网数据包，内网全部使用代理方式联网。</p><p>防火墙这样配置，内网不转发到外网。</p><p><img src=/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%A4%9A%E8%AE%BE%E5%A4%87%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E8%B4%A6%E5%8F%B7%E9%98%B2%E6%A3%80%E6%B5%8B/%E9%98%B2%E7%81%AB%E5%A2%99.png alt=光猫路由器></p><p>这样配置完之后会发现是无法上网的。</p><p>之后我们打开openclash，在全局设置里这样配置。</p><p><img src=/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%A4%9A%E8%AE%BE%E5%A4%87%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E8%B4%A6%E5%8F%B7%E9%98%B2%E6%A3%80%E6%B5%8B/openchash.png alt=光猫路由器></p><p>核心推荐使用Meta核心，这个核心速度快且更强大。
<img src=/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%A4%9A%E8%AE%BE%E5%A4%87%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E8%B4%A6%E5%8F%B7%E9%98%B2%E6%A3%80%E6%B5%8B/meta%E6%A0%B8%E5%BF%83.png alt=光猫路由器></p><p>添加一个没什么用的代理配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>mixed-port</span>: <span style=color:#ae81ff>7890</span>
</span></span><span style=display:flex><span><span style=color:#f92672>allow-lan</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>bind-address</span>: <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mode</span>: <span style=color:#ae81ff>Rule</span>
</span></span><span style=display:flex><span><span style=color:#f92672>log-level</span>: <span style=color:#ae81ff>silent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>external-controller</span>: <span style=color:#ae81ff>0.0.0.0</span>:<span style=color:#ae81ff>9090</span>
</span></span><span style=display:flex><span><span style=color:#f92672>redir-port</span>: <span style=color:#ae81ff>7892</span>
</span></span><span style=display:flex><span><span style=color:#f92672>port</span>: <span style=color:#ae81ff>7890</span>
</span></span><span style=display:flex><span><span style=color:#f92672>socks-port</span>: <span style=color:#ae81ff>7891</span>
</span></span><span style=display:flex><span><span style=color:#f92672>secret</span>: <span style=color:#e6db74>&#34;123456&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>external-ui</span>: <span style=color:#e6db74>&#34;/usr/share/openclash/dashboard&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>dns</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enable</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ipv6</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>enhanced-mode</span>: <span style=color:#ae81ff>fake-ip</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>fake-ip-range</span>: <span style=color:#ae81ff>198.18.0.1</span><span style=color:#ae81ff>/16</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>listen</span>: <span style=color:#ae81ff>0.0.0.0</span>:<span style=color:#ae81ff>7874</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##Custom DNS##</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nameserver</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>112.124.47.27</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#===================== OpenClash-General-Settings =====================#</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Proxy</span>:
</span></span><span style=display:flex><span>  - {<span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;ss&#34;</span>,<span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;v2rayse_test_1&#34;</span>,<span style=color:#e6db74>&#34;server&#34;</span>:<span style=color:#e6db74>&#34;198.57.27.218&#34;</span>,<span style=color:#e6db74>&#34;port&#34;</span>:<span style=color:#ae81ff>5004</span>,<span style=color:#e6db74>&#34;cipher&#34;</span>:<span style=color:#e6db74>&#34;aes-256-gcm&#34;</span>,<span style=color:#e6db74>&#34;password&#34;</span>:<span style=color:#e6db74>&#34;g5MeD6Ft3CWlJId&#34;</span>}
</span></span><span style=display:flex><span>  - {<span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;vmess&#34;</span>,<span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;v2rayse_test_2&#34;</span>,<span style=color:#e6db74>&#34;server&#34;</span>:<span style=color:#e6db74>&#34;154.23.190.162&#34;</span>,<span style=color:#e6db74>&#34;port&#34;</span>:<span style=color:#ae81ff>443</span>,<span style=color:#e6db74>&#34;uuid&#34;</span>:<span style=color:#e6db74>&#34;b9984674-f771-4e67-a198-c7e60720ba2c&#34;</span>,<span style=color:#e6db74>&#34;alterId&#34;</span>:<span style=color:#e6db74>&#34;0&#34;</span>,<span style=color:#e6db74>&#34;cipher&#34;</span>:<span style=color:#e6db74>&#34;auto&#34;</span>,<span style=color:#e6db74>&#34;network&#34;</span>:<span style=color:#e6db74>&#34;ws&#34;</span>}
</span></span><span style=display:flex><span>  - {<span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;ssr&#34;</span>,<span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;v2rayse_test_3&#34;</span>,<span style=color:#e6db74>&#34;server&#34;</span>:<span style=color:#e6db74>&#34;20.239.49.44&#34;</span>,<span style=color:#e6db74>&#34;port&#34;</span>:<span style=color:#ae81ff>59814</span>,<span style=color:#e6db74>&#34;protocol&#34;</span>:<span style=color:#e6db74>&#34;origin&#34;</span>,<span style=color:#e6db74>&#34;cipher&#34;</span>:<span style=color:#e6db74>&#34;dummy&#34;</span>,<span style=color:#e6db74>&#34;obfs&#34;</span>:<span style=color:#e6db74>&#34;plain&#34;</span>,<span style=color:#e6db74>&#34;password&#34;</span>:<span style=color:#e6db74>&#34;3df57276-03ef-45cf-bdd4-4edb6dfaa0ef&#34;</span>}
</span></span><span style=display:flex><span>  - {<span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;trojan&#34;</span>,<span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;v2rayse_test_4&#34;</span>,<span style=color:#e6db74>&#34;server&#34;</span>:<span style=color:#e6db74>&#34;ca-trojan.bonds.id&#34;</span>,<span style=color:#e6db74>&#34;port&#34;</span>:<span style=color:#ae81ff>443</span>,<span style=color:#e6db74>&#34;password&#34;</span>:<span style=color:#e6db74>&#34;bc7593fe-0604-4fbe-a70bYWVzLTI1Ni1nY206Q1VuZFNabllzUEtjdTaclWNFc1RmRBNk5NQU5KSnga3fa58ac5a3ef0-b4ab-11eb-b65e-1239d0255272&#34;</span>,<span style=color:#e6db74>&#34;udp&#34;</span>:<span style=color:#66d9ef>true</span>,<span style=color:#e6db74>&#34;skip-cert-verify&#34;</span>:<span style=color:#66d9ef>true</span>}
</span></span><span style=display:flex><span><span style=color:#f92672>Proxy Group</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>自定义分组</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>select</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxies</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>v2rayse_test_1</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>v2rayse_test_2</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>v2rayse_test_3</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>v2rayse_test_4</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Rule</span>:
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>MATCH,DIRECT</span>
</span></span></code></pre></div><p>最后启动openclash，这样局域网中的所有连接就都被路由器代理了。</p><h2 id=第一套方案实践>第一套方案实践</h2><h3 id=1购买软路由>1.购买软路由</h3><p>我选择的是FriendlyElec NanoPi-R1S-H5开发板。</p><p>在小黄鱼上150多一个</p><p><img src=/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%A4%9A%E8%AE%BE%E5%A4%87%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E8%B4%A6%E5%8F%B7%E9%98%B2%E6%A3%80%E6%B5%8B/%E8%BD%AF%E8%B7%AF%E7%94%B1.jpg alt=软路由图片></p><h3 id=2刷固件>2.刷固件</h3><p>openrt固件是2020-03-20-NanoPi R1s H5_full_v2.1 里面貌似自带了 rkp-ipid
可以在这里下载到：https://www.ethanshooter.com/blog/57.html</p><p>这个开发板刷固件比较简单，只需要把镜像写入SD卡插入即可。系统直接在SD卡上运行。</p><h3 id=3设置openwrt>3.设置openwrt</h3><p>刷完固件之后，插上电，等一会就会出现一个WIFI “FrendlyWrt-XXXXXX” 初始密码是passdo20。</p><p>连接WIFI之后进入管理页面。初始账号是root，密码是password</p><p>按照上述应对方案配置openwrt。</p><h3 id=使用体验>使用体验</h3><p>使用openclash的方法是最稳定的，并且还可以科学上网。</p><p>强制把80和8080端口转发到Privoxy后会出现一些问题，有些服务器的80和8080不是http协议就会导致无法连接。</p></div></div></div></div><div id=页脚><div class=页脚内容><p>本设计由简.精心制作</p><a href=/>Copyright © 2016-2020 简的秘密基地. All rights reserved.</a></div></div></body></html>